<html>
<head>
</head>
<body>
    <h1>The Open-Measure Knowledge Graph</h1>
    <input
      type="button"
      onclick="resetAll()"
      value="Destroy the network and restart it.">
    <input
      type="button" onclick="addNode()" value="add node dynamically" />
    <input
      type="button"
      onclick="loadNode()"
      value="Load Node"
    />


  <!--https://select2.org/getting-started/basic-usage-->
<script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<label for="mySelect2">
  Click this to highlight the multiple select element
  <select class="js-example-basic-multiple js-states form-control" id="mySelect2" multiple="multiple"  style="width: 75%">
  </select>
</label>

<script type="text/javascript">
var selectableItems = [
    {
      text: "Concepts",
      children: [
        {id: "n1", text: "Authentication Factors"},
        {id: "n2", text: "Inherence Factor"},
        {id: "n3", text: "Possession Factor"}
      ]
    },
    {
      text: "Processes",
      children: [
        {id: "n4", text: "Application Onboarding"},
        {id: "n5", text: "Provisioning"}
      ]
    }
  ];

nodesArray = [
          { id: "n1", label: "Authentication Factors" ,category:"Concept", url:"https://open-measure.atlassian.net/wiki/spaces/DIC/pages/1061650689"},
          { id: "n2", label: "Inherence Factor" ,category:"Concept", url:"https://open-measure.atlassian.net/wiki/spaces/DIC/pages/1061650689"},
          { id: "n3", label: "Possession Factor" ,category:"Concept", url:"https://open-measure.atlassian.net/wiki/spaces/DIC/pages/1061650689"},
          { id: "n4", label: "Application Onboarding" ,category:"Process", url:"https://open-measure.atlassian.net/wiki/spaces/DIC/pages/1061650689"},
          { id: "n5", label: "Provisioning" ,category:"Process", url:"https://open-measure.atlassian.net/wiki/spaces/DIC/pages/1061650689"},
        ];

edgesArray = [
          { id: "e1", from: "n1", to: "n2", label:"is a",arrows:"to" },
          { id: "e2", from: "n2", to: "n4", label:"is a",arrows:"to" },
          { id: "e3", from: "n3", to: "n4", label:"is a",arrows:"to" },
          { id: "e4", from: "n4", to: "n5", label:"is a",arrows:"to" },
        ];

  // In your Javascript (external .js resource or <script> tag)
$(document).ready(function() {

    $('.js-example-basic-multiple').select2({
      tags: true,
      tokenSeparators: [',', ' '],
      data: selectableItems,
      createTag: function(params) {
                return undefined;
           }
    });

    $('#mySelect2').on('select2:select', function (e) {
      var nodeId = e.params.data.id;
      document.getElementById("debugDiv").innerText = nodeId;
      loadNode(nodeId);
    });

  });
</script>
<div id="debugDiv"></div>
<div id="mynetwork"></div>
<script type="text/javascript" src="https://unpkg.com/vis-data@latest/peer/umd/vis-data.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/vis-network@latest/peer/umd/vis-network.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://unpkg.com/vis-network/styles/vis-network.min.css" />
<div id="mynetwork"></div>
<script type="text/javascript">

var nodes = new vis.DataSet(); //nodesArray);
var edges = new vis.DataSet(); //edgesArray);

function startNetwork(){
  var container = document.getElementById("mynetwork");
        var data = {
          nodes: nodes,
          edges: edges,
        };

  /*Source: view-source:https://visjs.github.io/vis-network/examples/network/other/navigation.html*/
  var options = {
    interaction: {
      navigationButtons: true,
      keyboard: true,
    }};

    network = new vis.Network(container, data, options);
    network.on("doubleClick", function (params) {
      onDoubleClick(params);
      });
    }

startNetwork();

function onDoubleClick(params) {
    var nodeIDs = params.nodes[0];
    var myNode = nodes.get(nodeIDs);
    var url  = myNode.url;
    document.getElementsByName('wikiPage')[0].src = url;
  }

function addNode() {
        var newId = (Math.random() * 1e7).toString(32);
        nodes.add({ id: newId, label: "I'm new!" });
        nodeIds.push(newId);
  }

function resetAll() {
  if (network !== null) {
          network.destroy();
          network = null;
  }
        startNetwork();
}

function getNode(nodeId){
  var result = nodesArray.filter(obj => {
    return obj.id === nodeId
    });
  return result;
}

function getNodeEdges(nodeId){
  var result = edgesArray.filter(obj => {
    return obj.from === nodeId || obj.to === nodeId
    });
  return result;
}

function debug(something){
    document.getElementById("debugDiv").innerText = JSON.stringify(something);
}

function loadNode(nodeId){
  var mergedNodes = getNode(nodeId);
  nodes.update(mergedNodes);
  var mergedEdges = getNodeEdges(nodeId);
  debug(mergedEdges);
  edges.update(mergedEdges);
  /*
  var mergedEdges = getNodeEdges(nodeId);
  edges.update(mergedEdges);
  */
}

function loadNode_OLD(){

    // provide data in the DOT language
      /*
    var DOTstring = 'dinetwork {a1 -> a1 -> a2;a2 -> a3; a2 -- a4; a2 -> a1 }';
    var parsedData = vis.parseDOTNetwork(DOTstring);
    var data = {
      nodes: parsedData.nodes,
      edges: parsedData.edges
    }
    */
      mergedNodes = [
          { id: "n1", label: "Node 1" },
          { id: "n2", label: "Node 2" },
          { id: "n3", label: "Node 3" },
          { id: "n4", label: "Node 4" },
          { id: "n5", label: "Node 5" }
        ];
    mergedEdges = [
          { id:"e1", from: "n1", to: "n2" ,label:"is a",arrows:"to"},
          { id:"e2", from: "n2", to: "n2" },
          { id:"e3", from: "n3", to: "n2" },
          { id:"e4", from: "n4", to: "n1" },
        ];

    nodes.update(mergedNodes);
    edges.update(mergedEdges);

    }
</script>
</body>
</html>
