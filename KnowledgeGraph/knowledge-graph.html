<html>
<head>
</head>
<body>
    <h1>The Open-Measure Knowledge Graph</h1>
    <input
      type="button"
      onclick="resetAll()"
      value="Destroy the network and restart it.">
    <input
      type="button" onclick="addNode()" value="add node dynamically" />
    <input
      type="button"
      onclick="loadNode()"
      value="Load Node"
    />


  <!--https://select2.org/getting-started/basic-usage-->
<script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<label for="mySelect2">
  Click this to highlight the multiple select element
  <select class="js-example-basic-multiple js-states form-control" id="mySelect2" multiple="multiple"  style="width: 75%">
  </select>
</label>
<div id="debugDiv"></div>
  <div id="selectedItemDiv"></div>
<div id="mynetwork"></div>

  <script type="text/javascript" src="https://unpkg.com/vis-data@latest/peer/umd/vis-data.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/vis-network@latest/peer/umd/vis-network.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://unpkg.com/vis-network/styles/vis-network.min.css" />

<script type="text/javascript">

function debug(something){
    document.getElementById("debugDiv").innerText = JSON.stringify(something);
}

var selectableItems = [
    {
      text: "Concepts",
      children: [
        {id: "n1", text: "Authentication Factors"},
        {id: "n2", text: "Inherence Factor"},
        {id: "n3", text: "Possession Factor"}
      ]
    },
    {
      text: "Processes",
      children: [
        {id: "n4", text: "Application Onboarding"},
        {id: "n5", text: "Provisioning"}
      ]
    }
  ];

var edgesDatabase = [
          { id: "e1", from: "n2", to: "n1", label:"is a", arrows:"to" },
          { id: "e2", from: "n3", to: "n1", label:"is a", arrows:"to" },
          { id: "e3", from: "n3", to: "n4", label:"is a", arrows:"to" },
          { id: "e4", from: "n4", to: "n5", label:"is a", arrows:"to" }
        ];

var nodesDatabase = [
          { id: "n1", label: "Authentication Factors", category:"Concept", url:"https://open"},
          { id: "n2", label: "Inherence Factor", category:"Concept", url:"https://open"},
          { id: "n3", label: "Possession Factor", category:"Concept", url:"https://open"},
          { id: "n4", label: "Application Onboarding", category:"Process", url:"https://open"},
          { id: "n5", label: "Provisioning", category:"Process", url:"https://open"}
        ];

$(document).ready(function() {

    $('.js-example-basic-multiple').select2({
      tags: true,
      tokenSeparators: [',', ' '],
      data: selectableItems,
      createTag: function(params) {
                return undefined;
           }
    });

    $('#mySelect2').on('select2:select', function (e) {
      var nodeId = e.params.data.id;
      document.getElementById("debugDiv").innerText = nodeId;
      loadNode(nodeId);
    });


  });

  var nodes = new vis.DataSet(); //nodesArray);
  var edges = new vis.DataSet(); //edgesArray);

function startNetwork(){
  var container = document.getElementById("mynetwork");
        var data = {
          nodes: nodes,
          edges: edges,
        };

  /*Source: view-source:https://visjs.github.io/vis-network/examples/network/other/navigation.html*/
  var options = {
    interaction: {
      navigationButtons: true,
      keyboard: true,
    }};

    network = new vis.Network(container, data, options);
    network.on("doubleClick", function (params) {
      onDoubleClick(params);
      });
    }

startNetwork();

function onDoubleClick(params) {
    var nodeIDs = params.nodes[0];
    var myNode = nodes.get(nodeIDs);
    var url  = myNode.url;
    document.getElementById("selectedItemDiv").innerHtml = url;
  }

function resetAll() {
  if (network !== null) {
    network.destroy();
    network = null;
  }
  startNetwork();
}

function getNode(nodeId){
  var result = nodesDatabase.filter(obj => {
    return obj.id === nodeId
    });
  return result[0];
}

function loadAdjacent(nodeId){
  for (i = 0; i < edgesDatabase.length; i++) {
    myEdge = edgesDatabase[i];
    if(myEdge.from == nodeId || myEdge.to == nodeId){
      edges.update(myEdge);
      nodes.update(getNode(myEdge.from));
      nodes.update(getNode(myEdge.to));
    }
  }
}

function loadNode(nodeId){
  var targetNode = getNode(nodeId);
  nodes.update(targetNode);
  loadAdjacent(nodeId);
}

</script>
</body>
</html>
